<!DOCTYPE html>
<html lang="en">

<head>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66582-32"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-66582-32');
    </script>

    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Snowflake Ingestion (2) Create Feature groups in Python" />
<meta property="og:description" content="Telecom Customer Churn Prediction Feature Engineering This tutorial is based on this Kaggle notebook and this Feast notebook
1. Churn Feature Engineering from hops import pandas_helper as pandas from hops import featurestore import pandas as pd import numpy as np import os import sklearn # Tested with 0.22.1 from slugify import slugify import snowflake.connector # tested on snowflake-connector-python==2.3.1  Starting Spark application   IDYARN Application IDKindStateSpark UIDriver log51application_1598866185540_0015pysparkidleLinkLink SparkSession available as &#39;spark&#39;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://examples.hopsworks.ai/featurestore/snowflake/pythonchurncreatefeaturegroups/" />



<meta property="article:published_time" content="2021-02-24T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2021-02-24T00:00:00&#43;00:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Snowflake Ingestion (2) Create Feature groups in Python"/>
<meta name="twitter:description" content="Telecom Customer Churn Prediction Feature Engineering This tutorial is based on this Kaggle notebook and this Feast notebook
1. Churn Feature Engineering from hops import pandas_helper as pandas from hops import featurestore import pandas as pd import numpy as np import os import sklearn # Tested with 0.22.1 from slugify import slugify import snowflake.connector # tested on snowflake-connector-python==2.3.1  Starting Spark application   IDYARN Application IDKindStateSpark UIDriver log51application_1598866185540_0015pysparkidleLinkLink SparkSession available as &#39;spark&#39;."/>
<meta name="generator" content="Hugo 0.40.3" />

    
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Snowflake Ingestion (2) Create Feature groups in Python",
  "url": "https://examples.hopsworks.ai/featurestore/snowflake/pythonchurncreatefeaturegroups/",
  "wordCount": "1200",
  "datePublished": "2021-02-24T00:00:00&#43;00:00",
  "dateModified": "2021-02-24T00:00:00&#43;00:00",
  "author": {
  "@type": "Person",
  "name": ""
  }
  }
</script> 

    <title>Snowflake Ingestion (2) Create Feature groups in Python</title>

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

    
    <link href="https://examples.hopsworks.ai/css/custom.css" rel="stylesheet">
    <link href="https://examples.hopsworks.ai/css/syntax.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Muli:400,500,700" rel="stylesheet">

    <link href="" rel="alternate" type="application/rss+xml" title="Hopsworks Examples" />

    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

</head>

<body>

    <nav class="navbar navbar-expand-sm fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="https://examples.hopsworks.ai">Hopsworks Examples</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="nav navbar-nav mr-auto"></ul>
                <ul class="nav navbar-nav">
                    <li><a href="https://hopsworks.ai" title="Hopsworks.ai">Hopsworks</a></li>
                    <li><a href="https://docs.hopsworks.ai" title="Docs">Docs</a></li>
                </ul>
            </div>
        </div>
    </nav>


    
    <div class="container">
        <div class="row">
            <div class="col-sm-12">

                 


<article>
  <div class="technical_note">
    <header>
      <div class="alert alert-warning flashcard_ad" role="alert">
	Want to learn machine learning? Try my <a href="https://machinelearningflashcards.com" class="alert-link">machine learning flashcards</a>, <a href='https://amzn.to/2HwnWty' class="alert-link">book</a>, or <a href='https://www.youtube.com/channel/UCnd4Fi-ODvuPbxR2fO2j7kA' class="alert-link">study with me.</a>.
      </div>
      <h1 class="technical_note_title">Snowflake Ingestion (2) Create Feature groups in Python</h1>
      <div class="technical_note_date">
	<time datetime=" 2021-02-24T00:00:00Z "> 24 Feb 2021</time>
      </div>
    </header>
    <div class="content">

      

<h1 id="telecom-customer-churn-prediction-feature-engineering">Telecom Customer Churn Prediction Feature Engineering</h1>

<p>This tutorial is based on <a href="https://www.kaggle.com/pavanraj159/telecom-customer-churn-prediction/comments#6.-Model-Performances">this</a> Kaggle notebook and <a href="https://github.com/gojek/feast/tree/master/examples/feast-xgboost-churn-prediction-tutorial">this</a> Feast notebook</p>

<h2 id="1-churn-feature-engineering">1. Churn Feature Engineering</h2>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">hops</span> <span class="kn">import</span> <span class="n">pandas_helper</span> <span class="k">as</span> <span class="n">pandas</span>
<span class="kn">from</span> <span class="nn">hops</span> <span class="kn">import</span> <span class="n">featurestore</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sklearn</span> <span class="c1"># Tested with 0.22.1</span>
<span class="kn">from</span> <span class="nn">slugify</span> <span class="kn">import</span> <span class="n">slugify</span>
<span class="kn">import</span> <span class="nn">snowflake.connector</span> <span class="c1"># tested on snowflake-connector-python==2.3.1 </span></code></pre></div>
<pre><code>Starting Spark application
</code></pre>

<table>
<tr><th>ID</th><th>YARN Application ID</th><th>Kind</th><th>State</th><th>Spark UI</th><th>Driver log</th></tr><tr><td>51</td><td>application_1598866185540_0015</td><td>pyspark</td><td>idle</td><td><a target="_blank" href="http://resourcemanager.service.consul:8088/proxy/application_1598866185540_0015/">Link</a></td><td><a target="_blank" href="http://ip-172-31-30-3.eu-north-1.compute.internal:8042/node/containerlogs/container_e08_1598866185540_0015_01_000001/redshift__meb10179">Link</a></td></tr></table>

<pre><code>SparkSession available as 'spark'.
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">db_pass</span> <span class="o">=</span> <span class="n">featurestore</span><span class="o">.</span><span class="n">get_storage_connector</span><span class="p">(</span><span class="s2">&#34;snowflake_spark_connector&#34;</span><span class="p">,</span><span class="n">featurestore</span><span class="o">=</span><span class="n">featurestore</span><span class="o">.</span><span class="n">project_featurestore</span><span class="p">())</span><span class="o">.</span><span class="n">arguments</span></code></pre></div>
<h3 id="1-1-data">1.1 Data</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">ctx</span> <span class="o">=</span> <span class="n">snowflake</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
  <span class="n">user</span><span class="o">=</span><span class="s1">&#39;HOPSWORKS&#39;</span><span class="p">,</span>
  <span class="n">password</span><span class="o">=</span><span class="n">db_pass</span><span class="p">,</span>
  <span class="n">account</span><span class="o">=</span><span class="s1">&#39;ra96958.eu-central-1&#39;</span><span class="p">,</span>
  <span class="n">warehouse</span><span class="o">=</span><span class="s1">&#39;HOPSWORKS_WH&#39;</span><span class="p">,</span>
  <span class="n">database</span><span class="o">=</span><span class="s1">&#39;ML_WORKSHOP&#39;</span><span class="p">,</span>
  <span class="n">schema</span><span class="o">=</span><span class="s1">&#39;PUBLIC&#39;</span>
<span class="p">)</span>

<span class="c1"># Query Snowflake Data</span>
<span class="n">cs</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">allrows</span><span class="o">=</span><span class="n">cs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;select * from CUSTOMER_CHURN &#34;&#34;&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">telcom</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">allrows</span><span class="p">)</span>
<span class="n">telcom</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;customer_id&#39;</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;senior_citizen&#39;</span><span class="p">,</span> <span class="s1">&#39;partner&#39;</span><span class="p">,</span> <span class="s1">&#39;dependents&#39;</span><span class="p">,</span>
       <span class="s1">&#39;tenure&#39;</span><span class="p">,</span> <span class="s1">&#39;phone_service&#39;</span><span class="p">,</span> <span class="s1">&#39;multiple_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;internet_service&#39;</span><span class="p">,</span>
       <span class="s1">&#39;online_security&#39;</span><span class="p">,</span> <span class="s1">&#39;online_backup&#39;</span><span class="p">,</span> <span class="s1">&#39;device_protection&#39;</span><span class="p">,</span> <span class="s1">&#39;tech_support&#39;</span><span class="p">,</span>
       <span class="s1">&#39;streaming_tv&#39;</span><span class="p">,</span> <span class="s1">&#39;streaming_movies&#39;</span><span class="p">,</span> <span class="s1">&#39;contract&#39;</span><span class="p">,</span> <span class="s1">&#39;paperless_billing&#39;</span><span class="p">,</span>
       <span class="s1">&#39;payment_method&#39;</span><span class="p">,</span> <span class="s1">&#39;monthly_charges&#39;</span><span class="p">,</span> <span class="s1">&#39;total_charges&#39;</span><span class="p">,</span> <span class="s1">&#39;churn&#39;</span><span class="p">]</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">telcom</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></code></pre></div>
<pre><code>  customer_id  gender  senior_citizen partner dependents  tenure phone_service    multiple_lines internet_service online_security online_backup device_protection tech_support streaming_tv streaming_movies        contract paperless_billing             payment_method  monthly_charges total_charges churn
0  7590-VHVEG  Female               0     Yes         No       1            No  No phone service              DSL              No           Yes                No           No           No               No  Month-to-month               Yes           Electronic check            29.85         29.85    No
1  5575-GNVDE    Male               0      No         No      34           Yes                No              DSL             Yes            No               Yes           No           No               No        One year                No               Mailed check            56.95        1889.5    No
2  3668-QPYBK    Male               0      No         No       2           Yes                No              DSL             Yes           Yes                No           No           No               No  Month-to-month               Yes               Mailed check            53.85        108.15   Yes
3  7795-CFOCW    Male               0      No         No      45            No  No phone service              DSL             Yes            No               Yes          Yes           No               No        One year                No  Bank transfer (automatic)            42.30       1840.75    No
4  9237-HQITU  Female               0      No         No       2           Yes                No      Fiber optic              No            No                No           No           No               No  Month-to-month               Yes           Electronic check            70.70        151.65   Yes
</code></pre>

<h3 id="1-2-data-manipulation">1.2 Data Manipulation</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Replacing spaces with null values in total charges column</span>
<span class="n">telcom</span><span class="p">[</span><span class="s1">&#39;total_charges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;total_charges&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="c1"># Dropping null values from total charges column which contain .15% missing data </span>
<span class="n">telcom</span> <span class="o">=</span> <span class="n">telcom</span><span class="p">[</span><span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;total_charges&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
<span class="n">telcom</span> <span class="o">=</span> <span class="n">telcom</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="n">telcom</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="c1"># Convert to float type</span>
<span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;total_charges&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;total_charges&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Replace &#39;No internet service&#39; to No for the following columns</span>
<span class="n">replace_cols</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;online_security&#39;</span><span class="p">,</span> <span class="s1">&#39;online_backup&#39;</span><span class="p">,</span> <span class="s1">&#39;device_protection&#39;</span><span class="p">,</span>
                <span class="s1">&#39;tech_support&#39;</span><span class="p">,</span><span class="s1">&#39;streaming_tv&#39;</span><span class="p">,</span> <span class="s1">&#39;streaming_movies&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">replace_cols</span> <span class="p">:</span> 
    <span class="n">telcom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="o">=</span> <span class="n">telcom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;internet_service&#39;</span> <span class="p">:</span> <span class="s1">&#39;No&#39;</span><span class="p">})</span>
    
<span class="c1"># Replace binary values with strings</span>
<span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;senior_citizen&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;senior_citizen&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span><span class="s2">&#34;Yes&#34;</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="s2">&#34;No&#34;</span><span class="p">})</span>

<span class="c1"># Tenure to categorical column</span>
<span class="k">def</span> <span class="nf">tenure_lab</span><span class="p">(</span><span class="n">telcom</span><span class="p">)</span> <span class="p">:</span>
    
    <span class="k">if</span> <span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;tenure&#34;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">12</span> <span class="p">:</span>
        <span class="k">return</span> <span class="s2">&#34;Tenure_0-12&#34;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;tenure&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;tenure&#34;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">24</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s2">&#34;Tenure_12-24&#34;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;tenure&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;tenure&#34;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">48</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="s2">&#34;Tenure_24-48&#34;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;tenure&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">48</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;tenure&#34;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">60</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="s2">&#34;Tenure_48-60&#34;</span>
    <span class="k">elif</span> <span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;tenure&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">60</span> <span class="p">:</span>
        <span class="k">return</span> <span class="s2">&#34;Tenure_gt_60&#34;</span>
<span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;tenure_group&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">telcom</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">telcom</span><span class="p">:</span><span class="n">tenure_lab</span><span class="p">(</span><span class="n">telcom</span><span class="p">),</span>
                                      <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Separating churn and non churn customers</span>
<span class="n">churn</span>     <span class="o">=</span> <span class="n">telcom</span><span class="p">[</span><span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;churn&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;Yes&#34;</span><span class="p">]</span>
<span class="n">not_churn</span> <span class="o">=</span> <span class="n">telcom</span><span class="p">[</span><span class="n">telcom</span><span class="p">[</span><span class="s2">&#34;churn&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;No&#34;</span><span class="p">]</span>

<span class="c1"># Separating catagorical and numerical columns</span>
<span class="n">Id_col</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;customer_id&#39;</span><span class="p">]</span>
<span class="n">target_col</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;churn&#34;</span><span class="p">]</span>
<span class="n">cat_cols</span>   <span class="o">=</span> <span class="n">telcom</span><span class="o">.</span><span class="n">nunique</span><span class="p">()[</span><span class="n">telcom</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">cat_cols</span>   <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target_col</span><span class="p">]</span>
<span class="n">num_cols</span>   <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">telcom</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="o">+</span> <span class="n">target_col</span> <span class="o">+</span> <span class="n">Id_col</span><span class="p">]</span>

<span class="n">telcom</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre></div>
<pre><code>  customer_id  gender senior_citizen partner dependents  tenure phone_service    multiple_lines internet_service online_security online_backup device_protection tech_support streaming_tv streaming_movies        contract paperless_billing             payment_method  monthly_charges  total_charges churn  tenure_group
0  7590-VHVEG  Female             No     Yes         No       1            No  No phone service              DSL              No           Yes                No           No           No               No  Month-to-month               Yes           Electronic check            29.85          29.85    No   Tenure_0-12
1  5575-GNVDE    Male             No      No         No      34           Yes                No              DSL             Yes            No               Yes           No           No               No        One year                No               Mailed check            56.95        1889.50    No  Tenure_24-48
2  3668-QPYBK    Male             No      No         No       2           Yes                No              DSL             Yes           Yes                No           No           No               No  Month-to-month               Yes               Mailed check            53.85         108.15   Yes   Tenure_0-12
3  7795-CFOCW    Male             No      No         No      45            No  No phone service              DSL             Yes            No               Yes          Yes           No               No        One year                No  Bank transfer (automatic)            42.30        1840.75    No  Tenure_24-48
4  9237-HQITU  Female             No      No         No       2           Yes                No      Fiber optic              No            No                No           No           No               No  Month-to-month               Yes           Electronic check            70.70         151.65   Yes   Tenure_0-12
</code></pre>

<h3 id="1-3-data-processing">1.3 Data Processing</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1"># Customer id col</span>
<span class="n">Id_col</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;customer_id&#39;</span><span class="p">]</span>

<span class="c1"># Target columns</span>
<span class="n">target_col</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;churn&#34;</span><span class="p">]</span>

<span class="c1"># Categorical columns</span>
<span class="n">cat_cols</span>   <span class="o">=</span> <span class="n">telcom</span><span class="o">.</span><span class="n">nunique</span><span class="p">()[</span><span class="n">telcom</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">cat_cols</span>   <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target_col</span><span class="p">]</span>

<span class="c1"># Numerical columns</span>
<span class="n">num_cols</span>   <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">telcom</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="o">+</span> <span class="n">target_col</span> <span class="o">+</span> <span class="n">Id_col</span><span class="p">]</span>

<span class="c1"># Binary columns with 2 values</span>
<span class="n">bin_cols</span>   <span class="o">=</span> <span class="n">telcom</span><span class="o">.</span><span class="n">nunique</span><span class="p">()[</span><span class="n">telcom</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Columns more than 2 values</span>
<span class="n">multi_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bin_cols</span><span class="p">]</span>

<span class="c1"># Label encoding Binary columns</span>
<span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bin_cols</span> <span class="p">:</span>
    <span class="n">telcom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">telcom</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
<span class="c1"># Duplicating columns for multi value columns</span>
<span class="n">telcom</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">telcom</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="n">multi_cols</span> <span class="p">)</span>

<span class="c1"># Scaling Numerical columns</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaled</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">telcom</span><span class="p">[</span><span class="n">num_cols</span><span class="p">])</span>
<span class="n">scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaled</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">num_cols</span><span class="p">)</span>

<span class="c1"># Dropping original values merging scaled values for numerical columns</span>
<span class="n">df_telcom_og</span> <span class="o">=</span> <span class="n">telcom</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">telcom</span> <span class="o">=</span> <span class="n">telcom</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">num_cols</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">telcom</span> <span class="o">=</span> <span class="n">telcom</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">scaled</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">how</span> <span class="o">=</span> <span class="s2">&#34;left&#34;</span><span class="p">)</span>

<span class="c1"># Clean up column names</span>
<span class="n">telcom</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">slugify</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">lowercase</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">telcom</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">telcom</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">telcom</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">telcom</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre></div>
<pre><code>  customer_id  gender  senior_citizen  partner  dependents  phone_service  paperless_billing  churn  multiple_lines_no  multiple_lines_no_phone_service  multiple_lines_yes  internet_service_dsl  internet_service_fiber_optic  internet_service_no  online_security_no  online_security_no_internet_service  online_security_yes  online_backup_no  online_backup_no_internet_service  online_backup_yes  device_protection_no  device_protection_no_internet_service  device_protection_yes  tech_support_no  tech_support_no_internet_service  tech_support_yes  streaming_tv_no  streaming_tv_no_internet_service  streaming_tv_yes  streaming_movies_no  streaming_movies_no_internet_service  streaming_movies_yes  contract_month_to_month  contract_one_year  contract_two_year  payment_method_bank_transfer_automatic  payment_method_credit_card_automatic  payment_method_electronic_check  payment_method_mailed_check  tenure_group_tenure_0_12  tenure_group_tenure_12_24  tenure_group_tenure_24_48  tenure_group_tenure_48_60  tenure_group_tenure_gt_60    tenure  monthly_charges  total_charges
0  7590-VHVEG       0               0        1           0              0                  1      0                  0                                1                   0                     1                             0                    0                   1                                    0                    0                 0                                  0                  1                     1                                      0                      0                1                                 0                 0                1                                 0                 0                    1                                     0                     0                        1                  0                  0                                       0                                     0                                1                            0                         1                          0                          0                          0                          0 -1.280248        -1.161694      -0.994194
1  5575-GNVDE       1               0        0           0              1                  0      0                  1                                0                   0                     1                             0                    0                   0                                    0                    1                 1                                  0                  0                     0                                      0                      1                1                                 0                 0                1                                 0                 0                    1                                     0                     0                        0                  1                  0                                       0                                     0                                0                            1                         0                          0                          1                          0                          0  0.064303        -0.260878      -0.173740
2  3668-QPYBK       1               0        0           0              1                  1      1                  1                                0                   0                     1                             0                    0                   0                                    0                    1                 0                                  0                  1                     1                                      0                      0                1                                 0                 0                1                                 0                 0                    1                                     0                     0                        1                  0                  0                                       0                                     0                                0                            1                         1                          0                          0                          0                          0 -1.239504        -0.363923      -0.959649
3  7795-CFOCW       1               0        0           0              0                  0      0                  0                                1                   0                     1                             0                    0                   0                                    0                    1                 1                                  0                  0                     0                                      0                      1                0                                 0                 1                1                                 0                 0                    1                                     0                     0                        0                  1                  0                                       1                                     0                                0                            0                         0                          0                          1                          0                          0  0.512486        -0.747850      -0.195248
4  9237-HQITU       0               0        0           0              1                  1      1                  1                                0                   0                     0                             1                    0                   1                                    0                    0                 1                                  0                  0                     1                                      0                      0                1                                 0                 0                1                                 0                 0                    1                                     0                     0                        1                  0                  0                                       0                                     0                                1                            0                         1                          0                          0                          0                          0 -1.239504         0.196178      -0.940457
</code></pre>

<h3 id="1-4-create-featuregroups">1.4 Create FeatureGroups</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">hops</span> <span class="kn">import</span> <span class="n">featurestore</span>

<span class="n">featurestore</span><span class="o">.</span><span class="n">create_featuregroup</span><span class="p">(</span>
    <span class="n">telcom</span><span class="p">,</span>
    <span class="s2">&#34;telcom_featuregroup&#34;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Telecom churn prediction feature group&#34;</span><span class="p">,</span> 
    <span class="n">online</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">descriptive_statistics</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">feature_correlation</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">feature_histograms</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">cluster_analysis</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span></code></pre></div>
<pre><code>computing descriptive statistics for : telcom_featuregroup, version: 1
computing feature correlation for: telcom_featuregroup, version: 1
computing feature histograms for: telcom_featuregroup, version: 1
computing cluster analysis for: telcom_featuregroup, version: 1
Registering feature metadata...
Registering feature metadata... [COMPLETE]
Writing feature data to offline feature group (Hive)...
Running sql: use redshift_featurestore against offline feature store
Writing feature data to offline feature group (Hive)... [COMPLETE]
Writing feature data to online feature group (MySQL)...
Writing feature data to online feature group (MySQL)... [COMPLETE]
Feature group created successfully
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">featurestore</span><span class="o">.</span><span class="n">set_featuregroup_tag</span><span class="p">(</span><span class="s2">&#34;telcom_featuregroup&#34;</span><span class="p">,</span> <span class="s2">&#34;privacy_level&#34;</span><span class="p">,</span> <span class="s2">&#34;pii&#34;</span><span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"></code></pre></div>
    </div>
    <aside>
      <div class="bug_reporting">
	<h4>Find an error or bug?</h4>
	<p>Everything on this site is available on GitHub. Head to <a href='https://github.com/chrisalbon/notes/issues/new'>and submit a suggested change</a>. Include the tutorial's URL in the issue.</p>
      </div>
    </aside>

  </div>
</article>




            </div>

        </div>
    </div>

    

    <footer class="footer text-center">
        <div class="container">
            <span class="text-muted">There are 59 notebooks and they are available on <a href="https://github.com/logicalclocks/hops-examples">GitHub</a>. Copyright &copy; Logical Clocks AB, <time datetime="2021">2021</time>.</span>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

</body>

</html>
