<!DOCTYPE html>
<html lang="en">

<head>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66582-32"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-66582-32');
    </script>

    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Visualization - What-if-Tool (Jupyter Classic)" />
<meta property="og:description" content="What-If Tool in a jupyter notebook WARNING: This notebook only runs on &ldquo;classic&rdquo; Jupyter, not on Jupyterlab.
This notebook shows use of the What-If Tool inside of a jupyter notebook.
This notebook trains a linear classifier on the UCI census problem (predicting whether a person earns more than $50K from their census information).
It then visualizes the results of the trained classifier on test data using the What-If Tool." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://examples.hopsworks.ai/ml/plotting/what_if_tool_notebook/" />



<meta property="article:published_time" content="2021-02-24T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2021-02-24T00:00:00&#43;00:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Visualization - What-if-Tool (Jupyter Classic)"/>
<meta name="twitter:description" content="What-If Tool in a jupyter notebook WARNING: This notebook only runs on &ldquo;classic&rdquo; Jupyter, not on Jupyterlab.
This notebook shows use of the What-If Tool inside of a jupyter notebook.
This notebook trains a linear classifier on the UCI census problem (predicting whether a person earns more than $50K from their census information).
It then visualizes the results of the trained classifier on test data using the What-If Tool."/>
<meta name="generator" content="Hugo 0.40.3" />

    
<script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Visualization - What-if-Tool (Jupyter Classic)",
  "url": "https://examples.hopsworks.ai/ml/plotting/what_if_tool_notebook/",
  "wordCount": "1348",
  "datePublished": "2021-02-24T00:00:00&#43;00:00",
  "dateModified": "2021-02-24T00:00:00&#43;00:00",
  "author": {
  "@type": "Person",
  "name": ""
  }
  }
</script> 

    <title>Visualization - What-if-Tool (Jupyter Classic)</title>

    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

    
    <link href="https://examples.hopsworks.ai/css/custom.css" rel="stylesheet">
    <link href="https://examples.hopsworks.ai/css/syntax.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Muli:400,500,700" rel="stylesheet">

    <link href="" rel="alternate" type="application/rss+xml" title="Hopsworks Examples" />

    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

</head>

<body>

    <nav class="navbar navbar-expand-sm fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="https://examples.hopsworks.ai">Hopsworks Examples</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="nav navbar-nav mr-auto"></ul>
                <ul class="nav navbar-nav">
                    <li><a href="https://hopsworks.ai" title="Hopsworks.ai">Hopsworks</a></li>
                    <li><a href="https://docs.hopsworks.ai" title="Docs">Docs</a></li>
                </ul>
            </div>
        </div>
    </nav>


    
    <div class="container">
        <div class="row">
            <div class="col-sm-12">

                 


<article>
  <div class="technical_note">
    <header>
      <div class="alert alert-warning flashcard_ad" role="alert">
	Want to learn machine learning? Try my <a href="https://machinelearningflashcards.com" class="alert-link">machine learning flashcards</a>, <a href='https://amzn.to/2HwnWty' class="alert-link">book</a>, or <a href='https://www.youtube.com/channel/UCnd4Fi-ODvuPbxR2fO2j7kA' class="alert-link">study with me.</a>.
      </div>
      <h1 class="technical_note_title">Visualization - What-if-Tool (Jupyter Classic)</h1>
      <div class="technical_note_date">
	<time datetime=" 2021-02-24T00:00:00Z "> 24 Feb 2021</time>
      </div>
    </header>
    <div class="content">

      

<h3 id="what-if-tool-in-a-jupyter-notebook">What-If Tool in a jupyter notebook</h3>

<p>WARNING: This notebook only runs on &ldquo;classic&rdquo; Jupyter, not on Jupyterlab.</p>

<p>This notebook shows use of the <a href="https://pair-code.github.io/what-if-tool">What-If Tool</a> inside of a jupyter notebook.</p>

<p>This notebook trains a linear classifier on the <a href="https://archive.ics.uci.edu/ml/datasets/census+income">UCI census problem</a> (predicting whether a person earns more than $50K from their census information).</p>

<p>It then visualizes the results of the trained classifier on test data using the What-If Tool.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#@title Define helper functions {display-mode: &#34;form&#34;}</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="c1"># Creates a tf feature spec from the dataframe and columns specified.</span>
<span class="k">def</span> <span class="nf">create_feature_spec</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">feature_spec</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">columns</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">):</span>
            <span class="n">feature_spec</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">FixedLenFeature</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">df</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">):</span>
            <span class="n">feature_spec</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">FixedLenFeature</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_spec</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">FixedLenFeature</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">feature_spec</span>

<span class="c1"># Creates simple numeric and categorical feature columns from a feature spec and a</span>
<span class="c1"># list of columns from that spec to use.</span>
<span class="c1">#</span>
<span class="c1"># NOTE: Models might perform better with some feature engineering such as bucketed</span>
<span class="c1"># numeric columns and hash-bucket/embedding columns for categorical features.</span>
<span class="k">def</span> <span class="nf">create_feature_columns</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">feature_spec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">tf</span><span class="o">.</span><span class="n">int64</span> <span class="ow">or</span> <span class="n">feature_spec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">feature_column</span><span class="o">.</span><span class="n">numeric_column</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">feature_column</span><span class="o">.</span><span class="n">indicator_column</span><span class="p">(</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">feature_column</span><span class="o">.</span><span class="n">categorical_column_with_vocabulary_list</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))))</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="c1"># An input function for providing input to a model from tf.Examples</span>
<span class="k">def</span> <span class="nf">tfexamples_input_fn</span><span class="p">(</span><span class="n">examples</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">ModeKeys</span><span class="o">.</span><span class="n">EVAL</span><span class="p">,</span>
                       <span class="n">num_epochs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                       <span class="n">batch_size</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">ex_generator</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">examples</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="n">examples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_generator</span><span class="p">(</span>
      <span class="n">ex_generator</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([]))</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">ModeKeys</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">tf_example</span><span class="p">:</span> <span class="n">parse_tf_example</span><span class="p">(</span><span class="n">tf_example</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">))</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dataset</span>

<span class="c1"># Parses Tf.Example protos into features for the input function.</span>
<span class="k">def</span> <span class="nf">parse_tf_example</span><span class="p">(</span><span class="n">example_proto</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">):</span>
    <span class="n">parsed_features</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">parse_example</span><span class="p">(</span><span class="n">serialized</span><span class="o">=</span><span class="n">example_proto</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">feature_spec</span><span class="p">)</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">parsed_features</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parsed_features</span><span class="p">,</span> <span class="n">target</span>

<span class="c1"># Converts a dataframe into a list of tf.Example protos.</span>
<span class="k">def</span> <span class="nf">df_to_examples</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">columns</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">example</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Example</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">):</span>
                <span class="n">example</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">int64_list</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">):</span>
                <span class="n">example</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">float_list</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]:</span>
                <span class="n">example</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">bytes_list</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">examples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">examples</span>

<span class="c1"># Converts a dataframe column into a column of 0&#39;s and 1&#39;s based on the provided test.</span>
<span class="c1"># Used to force label columns to be numeric for binary classification using a TF estimator.</span>
<span class="k">def</span> <span class="nf">make_label_column_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">label_column</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
  <span class="n">df</span><span class="p">[</span><span class="n">label_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">test</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">label_column</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#@title Read training dataset from CSV {display-mode: &#34;form&#34;}</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">hops.hdfs</span> <span class="kn">as</span> <span class="nn">hdfs</span>

<span class="c1"># Set the path to the CSV containing the dataset to train on.</span>
<span class="c1"># csv_path = &#39;https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data&#39;</span>

<span class="c1"># Set the column names for the columns in the CSV. If the CSV&#39;s first line is a header line containing</span>
<span class="c1"># the column names, then set this to None.</span>
<span class="n">csv_columns</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s2">&#34;Age&#34;</span><span class="p">,</span> <span class="s2">&#34;Workclass&#34;</span><span class="p">,</span> <span class="s2">&#34;fnlwgt&#34;</span><span class="p">,</span> <span class="s2">&#34;Education&#34;</span><span class="p">,</span> <span class="s2">&#34;Education-Num&#34;</span><span class="p">,</span> <span class="s2">&#34;Marital-Status&#34;</span><span class="p">,</span>
  <span class="s2">&#34;Occupation&#34;</span><span class="p">,</span> <span class="s2">&#34;Relationship&#34;</span><span class="p">,</span> <span class="s2">&#34;Race&#34;</span><span class="p">,</span> <span class="s2">&#34;Sex&#34;</span><span class="p">,</span> <span class="s2">&#34;Capital-Gain&#34;</span><span class="p">,</span> <span class="s2">&#34;Capital-Loss&#34;</span><span class="p">,</span>
  <span class="s2">&#34;Hours-per-week&#34;</span><span class="p">,</span> <span class="s2">&#34;Country&#34;</span><span class="p">,</span> <span class="s2">&#34;Over-50K&#34;</span><span class="p">]</span>

<span class="c1"># Read the dataset from the provided CSV and print out information about it.</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">hdfs</span><span class="o">.</span><span class="n">get_fs</span><span class="p">()</span>
<span class="k">with</span> <span class="n">h</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">hdfs</span><span class="o">.</span><span class="n">project_path</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&#34;/TourData/census/adult.data&#34;</span><span class="p">,</span> <span class="s2">&#34;rt&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">trainFile</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">trainFile</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">csv_columns</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># df = pd.read_csv(csv_path, names=csv_columns, skipinitialspace=True)</span>

<span class="n">df</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Workclass</th>
      <th>fnlwgt</th>
      <th>Education</th>
      <th>Education-Num</th>
      <th>Marital-Status</th>
      <th>Occupation</th>
      <th>Relationship</th>
      <th>Race</th>
      <th>Sex</th>
      <th>Capital-Gain</th>
      <th>Capital-Loss</th>
      <th>Hours-per-week</th>
      <th>Country</th>
      <th>Over-50K</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>39</td>
      <td>State-gov</td>
      <td>77516</td>
      <td>Bachelors</td>
      <td>13</td>
      <td>Never-married</td>
      <td>Adm-clerical</td>
      <td>Not-in-family</td>
      <td>White</td>
      <td>Male</td>
      <td>2174</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>1</th>
      <td>50</td>
      <td>Self-emp-not-inc</td>
      <td>83311</td>
      <td>Bachelors</td>
      <td>13</td>
      <td>Married-civ-spouse</td>
      <td>Exec-managerial</td>
      <td>Husband</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>13</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>2</th>
      <td>38</td>
      <td>Private</td>
      <td>215646</td>
      <td>HS-grad</td>
      <td>9</td>
      <td>Divorced</td>
      <td>Handlers-cleaners</td>
      <td>Not-in-family</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>3</th>
      <td>53</td>
      <td>Private</td>
      <td>234721</td>
      <td>11th</td>
      <td>7</td>
      <td>Married-civ-spouse</td>
      <td>Handlers-cleaners</td>
      <td>Husband</td>
      <td>Black</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>4</th>
      <td>28</td>
      <td>Private</td>
      <td>338409</td>
      <td>Bachelors</td>
      <td>13</td>
      <td>Married-civ-spouse</td>
      <td>Prof-specialty</td>
      <td>Wife</td>
      <td>Black</td>
      <td>Female</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>Cuba</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>32556</th>
      <td>27</td>
      <td>Private</td>
      <td>257302</td>
      <td>Assoc-acdm</td>
      <td>12</td>
      <td>Married-civ-spouse</td>
      <td>Tech-support</td>
      <td>Wife</td>
      <td>White</td>
      <td>Female</td>
      <td>0</td>
      <td>0</td>
      <td>38</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>32557</th>
      <td>40</td>
      <td>Private</td>
      <td>154374</td>
      <td>HS-grad</td>
      <td>9</td>
      <td>Married-civ-spouse</td>
      <td>Machine-op-inspct</td>
      <td>Husband</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&gt;50K</td>
    </tr>
    <tr>
      <th>32558</th>
      <td>58</td>
      <td>Private</td>
      <td>151910</td>
      <td>HS-grad</td>
      <td>9</td>
      <td>Widowed</td>
      <td>Adm-clerical</td>
      <td>Unmarried</td>
      <td>White</td>
      <td>Female</td>
      <td>0</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>32559</th>
      <td>22</td>
      <td>Private</td>
      <td>201490</td>
      <td>HS-grad</td>
      <td>9</td>
      <td>Never-married</td>
      <td>Adm-clerical</td>
      <td>Own-child</td>
      <td>White</td>
      <td>Male</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
      <td>United-States</td>
      <td>&lt;=50K</td>
    </tr>
    <tr>
      <th>32560</th>
      <td>52</td>
      <td>Self-emp-inc</td>
      <td>287927</td>
      <td>HS-grad</td>
      <td>9</td>
      <td>Married-civ-spouse</td>
      <td>Exec-managerial</td>
      <td>Wife</td>
      <td>White</td>
      <td>Female</td>
      <td>15024</td>
      <td>0</td>
      <td>40</td>
      <td>United-States</td>
      <td>&gt;50K</td>
    </tr>
  </tbody>
</table>
<p>32561 rows × 15 columns</p>
</div>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#@title Specify input columns and column to predict {display-mode: &#34;form&#34;}</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># Set the column in the dataset you wish for the model to predict</span>
<span class="n">label_column</span> <span class="o">=</span> <span class="s1">&#39;Over-50K&#39;</span>

<span class="c1"># Make the label column numeric (0 and 1), for use in our model.</span>
<span class="c1"># In this case, examples with a target value of &#39;&gt;50K&#39; are considered to be in</span>
<span class="c1"># the &#39;1&#39; (positive) class and all other examples are considered to be in the</span>
<span class="c1"># &#39;0&#39; (negative) class.</span>
<span class="n">make_label_column_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">label_column</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="n">val</span> <span class="o">==</span> <span class="s1">&#39;&gt;50K&#39;</span><span class="p">)</span>

<span class="c1"># Set list of all columns from the dataset we will use for model input.</span>
<span class="n">input_features</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Workclass&#39;</span><span class="p">,</span> <span class="s1">&#39;Education&#39;</span><span class="p">,</span> <span class="s1">&#39;Marital-Status&#39;</span><span class="p">,</span> <span class="s1">&#39;Occupation&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Relationship&#39;</span><span class="p">,</span> <span class="s1">&#39;Race&#39;</span><span class="p">,</span> <span class="s1">&#39;Sex&#39;</span><span class="p">,</span> <span class="s1">&#39;Capital-Gain&#39;</span><span class="p">,</span> <span class="s1">&#39;Capital-Loss&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Hours-per-week&#39;</span><span class="p">,</span> <span class="s1">&#39;Country&#39;</span><span class="p">]</span>

<span class="c1"># Create a list containing all input features and the label column</span>
<span class="n">features_and_labels</span> <span class="o">=</span> <span class="n">input_features</span> <span class="o">+</span> <span class="p">[</span><span class="n">label_column</span><span class="p">]</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#@title Convert dataset to tf.Example protos {display-mode: &#34;form&#34;}</span>

<span class="n">examples</span> <span class="o">=</span> <span class="n">df_to_examples</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#@title Create and train the classifier {display-mode: &#34;form&#34;}</span>

<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1">#@param {type: &#34;number&#34;}</span>

<span class="c1"># Create a feature spec for the classifier</span>
<span class="n">feature_spec</span> <span class="o">=</span> <span class="n">create_feature_spec</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features_and_labels</span><span class="p">)</span>

<span class="c1"># Define and train the classifier</span>
<span class="n">train_inpf</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tfexamples_input_fn</span><span class="p">,</span> <span class="n">examples</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">,</span> <span class="n">label_column</span><span class="p">)</span>
<span class="n">classifier</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">LinearClassifier</span><span class="p">(</span>
    <span class="n">feature_columns</span><span class="o">=</span><span class="n">create_feature_columns</span><span class="p">(</span><span class="n">input_features</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">))</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">train_inpf</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">num_steps</span><span class="p">)</span></code></pre></div>
<pre><code>INFO:tensorflow:Using default config.
WARNING:tensorflow:Using temporary folder as model directory: /tmp/tmphg54156d
INFO:tensorflow:Using config: {'_model_dir': '/tmp/tmphg54156d', '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': None, '_save_checkpoints_secs': 600, '_session_config': allow_soft_placement: true
graph_options {
  rewrite_options {
    meta_optimizer_iterations: ONE
  }
}
, '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': 100, '_train_distribute': None, '_device_fn': None, '_protocol': None, '_eval_distribute': None, '_experimental_distribute': None, '_experimental_max_worker_delay_secs': None, '_session_creation_timeout_secs': 7200, '_service': None, '_cluster_spec': ClusterSpec({}), '_task_type': 'worker', '_task_id': 0, '_global_id_in_cluster': 0, '_master': '', '_evaluation_master': '', '_is_chief': True, '_num_ps_replicas': 0, '_num_worker_replicas': 1}
WARNING:tensorflow:From /srv/hops/anaconda/envs/theenv/lib/python3.6/site-packages/tensorflow/python/training/training_util.py:236: Variable.initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
INFO:tensorflow:Calling model_fn.
WARNING:tensorflow:From /srv/hops/anaconda/envs/theenv/lib/python3.6/site-packages/tensorflow_estimator/python/estimator/canned/linear.py:1481: Layer.add_variable (from tensorflow.python.keras.engine.base_layer_v1) is deprecated and will be removed in a future version.
Instructions for updating:
Please use `layer.add_weight` method instead.
WARNING:tensorflow:From /srv/hops/anaconda/envs/theenv/lib/python3.6/site-packages/tensorflow/python/keras/optimizer_v2/ftrl.py:112: calling Constant.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
INFO:tensorflow:Done calling model_fn.
INFO:tensorflow:Create CheckpointSaverHook.
INFO:tensorflow:Graph was finalized.
INFO:tensorflow:Running local_init_op.
INFO:tensorflow:Done running local_init_op.
INFO:tensorflow:Calling checkpoint listeners before saving checkpoint 0...
INFO:tensorflow:Saving checkpoints for 0 into /tmp/tmphg54156d/model.ckpt.
INFO:tensorflow:Calling checkpoint listeners after saving checkpoint 0...
INFO:tensorflow:loss = 0.6931472, step = 0
INFO:tensorflow:global_step/sec: 33.0106
INFO:tensorflow:loss = 1.2316809, step = 100 (3.032 sec)
INFO:tensorflow:global_step/sec: 35.9212
INFO:tensorflow:loss = 2.1111045, step = 200 (2.783 sec)
INFO:tensorflow:global_step/sec: 36.3198
INFO:tensorflow:loss = 1.3279744, step = 300 (2.754 sec)
INFO:tensorflow:global_step/sec: 35.3992
INFO:tensorflow:loss = 2.732805, step = 400 (2.825 sec)
INFO:tensorflow:global_step/sec: 34.4937
INFO:tensorflow:loss = 0.6547704, step = 500 (2.899 sec)
INFO:tensorflow:global_step/sec: 36.1927
INFO:tensorflow:loss = 0.5864808, step = 600 (2.762 sec)
INFO:tensorflow:global_step/sec: 35.5821
INFO:tensorflow:loss = 0.29896152, step = 700 (2.811 sec)
INFO:tensorflow:global_step/sec: 35.4071
INFO:tensorflow:loss = 2.0995965, step = 800 (2.827 sec)
INFO:tensorflow:global_step/sec: 34.6815
INFO:tensorflow:loss = 0.96475744, step = 900 (2.881 sec)
INFO:tensorflow:Calling checkpoint listeners before saving checkpoint 1000...
INFO:tensorflow:Saving checkpoints for 1000 into /tmp/tmphg54156d/model.ckpt.
INFO:tensorflow:Calling checkpoint listeners after saving checkpoint 1000...
INFO:tensorflow:Loss for final step: 0.6493055.





&lt;tensorflow_estimator.python.estimator.canned.linear.LinearClassifierV2 at 0x7f0628022f28&gt;
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#@title Invoke What-If Tool for test data and the trained model {display-mode: &#34;form&#34;}</span>

<span class="n">num_datapoints</span> <span class="o">=</span> <span class="mi">2000</span>  <span class="c1">#@param {type: &#34;number&#34;}</span>
<span class="n">tool_height_in_px</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1">#@param {type: &#34;number&#34;}</span>

<span class="kn">from</span> <span class="nn">witwidget.notebook.visualization</span> <span class="kn">import</span> <span class="n">WitConfigBuilder</span>
<span class="kn">from</span> <span class="nn">witwidget.notebook.visualization</span> <span class="kn">import</span> <span class="n">WitWidget</span>

<span class="c1"># Load up the test dataset</span>
<span class="c1">#test_csv_path = &#39;https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.test&#39;</span>
<span class="c1">#test_df = pd.read_csv(test_csv_path, names=csv_columns, skipinitialspace=True,</span>
<span class="c1">#  skiprows=1)</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">hdfs</span><span class="o">.</span><span class="n">get_fs</span><span class="p">()</span>
<span class="k">with</span> <span class="n">h</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">hdfs</span><span class="o">.</span><span class="n">project_path</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&#34;/TourData/census/adult.test&#34;</span><span class="p">,</span> <span class="s2">&#34;rt&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">testFile</span><span class="p">:</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">testFile</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">csv_columns</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">make_label_column_numeric</span><span class="p">(</span><span class="n">test_df</span><span class="p">,</span> <span class="n">label_column</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="n">val</span> <span class="o">==</span> <span class="s1">&#39;&gt;50K.&#39;</span><span class="p">)</span>
<span class="n">test_examples</span> <span class="o">=</span> <span class="n">df_to_examples</span><span class="p">(</span><span class="n">test_df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">num_datapoints</span><span class="p">])</span>

<span class="c1"># Setup the tool with the test examples and the trained classifier</span>
<span class="n">config_builder</span> <span class="o">=</span> <span class="n">WitConfigBuilder</span><span class="p">(</span><span class="n">test_examples</span><span class="p">)</span><span class="o">.</span><span class="n">set_estimator_and_feature_spec</span><span class="p">(</span>
    <span class="n">classifier</span><span class="p">,</span> <span class="n">feature_spec</span><span class="p">)</span><span class="o">.</span><span class="n">set_label_vocab</span><span class="p">([</span><span class="s1">&#39;Under 50K&#39;</span><span class="p">,</span> <span class="s1">&#39;Over 50K&#39;</span><span class="p">])</span>
<span class="n">WitWidget</span><span class="p">(</span><span class="n">config_builder</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">tool_height_in_px</span><span class="p">)</span></code></pre></div>
<style>.container { width:100% !important; }</style>

<pre><code>WitWidget(config={'model_type': 'classification', 'label_vocab': ['Under 50K', 'Over 50K'], 'are_sequence_exam…
</code></pre>

    </div>
    <aside>
      <div class="bug_reporting">
	<h4>Find an error or bug?</h4>
	<p>Everything on this site is available on GitHub. Head to <a href='https://github.com/chrisalbon/notes/issues/new'>and submit a suggested change</a>. Include the tutorial's URL in the issue.</p>
      </div>
    </aside>

  </div>
</article>




            </div>

        </div>
    </div>

    

    <footer class="footer text-center">
        <div class="container">
            <span class="text-muted">There are 59 notebooks and they are available on <a href="https://github.com/logicalclocks/hops-examples">GitHub</a>. Copyright &copy; Logical Clocks AB, <time datetime="2021">2021</time>.</span>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

</body>

</html>
